<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-reference/plan/plan-reference" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">PLAN | Pallas documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.opfn.co/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.opfn.co/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.opfn.co/reference/plan/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="PLAN | Pallas documentation"><meta data-rh="true" name="description" content="Reference for implementing a PLAN interpreter"><meta data-rh="true" property="og:description" content="Reference for implementing a PLAN interpreter"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.opfn.co/reference/plan/"><link data-rh="true" rel="alternate" href="https://docs.opfn.co/reference/plan/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.opfn.co/reference/plan/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4d1f9098.css">
<script src="/assets/js/runtime~main.6b8011e7.js" defer="defer"></script>
<script src="/assets/js/main.e054c1c1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/opfn-logo.png" alt="opfn logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/opfn-logo-light.png" alt="opfn logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Pallas docs</b></a><a class="navbar__item navbar__link" href="/">Explanation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reference/sire-runes-macros">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/operating-function/pallas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/reference/sire-runes-macros">Sire</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/sire-runes-macros">Runes</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/reference/standard-library/bits-booleans">Sire Standard Library</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/reference/vm-and-interpreter/jets-reference">VM and Interpreter</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/reference/plan/">PLAN</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PLAN</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>PLAN reference</h1></header>
<blockquote>
<p>Reference for implementing a PLAN interpreter</p>
</blockquote>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>TODO</div><div class="admonitionContent_BuS1"><p>Forthcoming</p></div></div>
<p>Pseudocode specification of PLAN:</p>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Every PLAN value is either a pin x:&lt;i&gt;, a law x:{n a b}, an app x:(f g),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a nat x:@, or a black hole x:&lt;&gt;.  Black holes only exist during evaluation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(o &lt;- x) mutates o in place, updating its value to equal x.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unmatched patterns diverge.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run F[x] to normalize a value, to &quot;evaluate&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">F[o] =                                  | N[o] = E[o]; if o:@ then o else 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E[o]                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when o:(f x)                        | C[z,p,n] = if n=0 then z else p (n-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         F[f]; F[x]                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    o                                   | S[o:(f x y)]       = (S[(f x)] y)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        | S[o:(&lt;{n a b}&gt; y)] = o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E[o] =                                  | S[o:(&lt;f&gt; x)]       = S[(f x)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when o:(f x)                        | S[o]               = o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        E[f]                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        when A[f]=1                     | I[f, (e x), 0] = x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o &lt;- S[o]                   | I[f, e,     0] = e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            o &lt;- X[o,o]                 | I[f, (e x), n] = I[f, e, n-1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            E[o]                        | I[f, e,     n] = f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    o                                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        | A[(f x)]     = A[f]-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[(f x), e]         = X[f,e]            | A[&lt;p&gt;]       = A[p]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[&lt;p&gt;, e]           = X[p,e]            | A[{n a b}]   = a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[{n a b}, e]       = B[a,a,e,b,b]      | A[n:@]       = I[1, (3 5 3), n]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[0, (_ n a b)]     = W[N[n],N[a],F[b]] |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[1, (_ p l a n x)] = P[p,l,a,n,E[x]]   | R[n,e,b:@] | b≤n = I[_,e,(n-b)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[2, (_ z p x)]     = C[z,p,N[x]]       | R[n,e,(0 f x)]   = (R[n,e,f] R[n,e,x])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[3, (_ x)]         = N[x]+1            | R[n,e,(2 x)]     = x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[4, (_ x)]         = &lt;F[x]&gt;            | R[n,e,x]         = x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L[i,n,e,(1 v b)] = I[_,e,i] &lt;- R[n,e,v] | P[p,l,a,n,(f x)]   = (a f x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   L[i+1,n,e,b]         | P[p,l,a,n,&lt;x&gt;]     = (p x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L[_,n,e,x]       = R[n,e,x]             | P[p,l,a,n,{n a b}] = (l n a b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        | P[p,l,a,n,x:@]     = (n x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">B[a,n,e,b,(1 _ k)] = B[a,n+1,(e &lt;&gt;),b,k]|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">B[a,n,e,b,x]       = L[a,n,e,b]         | W[n,a,b] | n&gt;0 = {n,a,b}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="law-body-edsl">Law body EDSL<a href="#law-body-edsl" class="hash-link" aria-label="Direct link to Law body EDSL" title="Direct link to Law body EDSL">​</a></h2>
<p>PLAN contains an embedded domain-specific language (EDSL) for defining law bodies. This EDSL is not a separate language per se, but rather a specific way of using PLAN constructs to represent law bodies. The B, L and R operations together define the semantics of this EDSL. Before going into these, it is informative to look at the EDSL for law bodies in the abstract. It doesn’t have a syntax, but if it did, it would look something like this:</p>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LawBody ::= Self                   -- self-reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          | Var Nat                -- var-reference (index into environment)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          | Literal PLAN           -- produce literal value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          | Apply LawBody LawBody  -- function application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          | let LawBody in LawBody -- let binding (append to environment)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The EDSL and PLAN proper are tightly intertwined:</p>
<p>Within a law body, you can always drop back into regular PLAN either by using the <code>Literal</code> construct (encoded using 2), or automatically when a part of the law body doesn&#x27;t have meaning in the EDSL.
Conversely, PLAN switches into the EDSL whenever executing a law.</p>
<p>This dual-language structure allows PLAN to maintain a simple core while providing more expressive power for defining functions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="evaluation-in-detail">Evaluation in detail<a href="#evaluation-in-detail" class="hash-link" aria-label="Direct link to Evaluation in detail" title="Direct link to Evaluation in detail">​</a></h2>
<p>We&#x27;ll look at each of the operations that appear the PLAN spec. But first, we have to cover &quot;black holes&quot;:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="black-holes-">Black Holes (<code>&lt;&gt;</code>)<a href="#black-holes-" class="hash-link" aria-label="Direct link to black-holes-" title="Direct link to black-holes-">​</a></h3>
<p><code>&lt;&gt;</code> are temporary placeholders used during evaluation to handle recursive bindings and thunks. They serve several purposes:</p>
<ul>
<li>As mutable placeholders during environment building</li>
<li>During evaluation of null-ary laws (E operation)</li>
<li>As detection for cyclic evaluations:</li>
</ul>
<p><strong>Black holes only exist during evaluation and should never appear in final normalized values.</strong></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="x-function-execution"><code>X</code> (function eXecution)<a href="#x-function-execution" class="hash-link" aria-label="Direct link to x-function-execution" title="Direct link to x-function-execution">​</a></h3>
<p>The relevant part of the pseudocode specification is the X operation, short for &quot;eXecute&quot;:</p>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">X[0, (_ n a b)]     = W[N[n],N[a],F[b]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[1, (_ p l a n x)] = P[p,l,a,n,E[x]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[2, (_ z p x)]     = C[z,p,N[x]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[3, (_ x)]         = N[x]+1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[4, (_ x)]         = &lt;F[x]&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[(f x), e]         = X[f,e]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[&lt;p&gt;, e]           = X[p,e]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X[{n a b}, e]       = B[a,a,e,b,b]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>X takes two arguments, a function and an environment that it should be executed in. Most of the time, the environment simply is simply the function itself followed by all its arguments. X is defined by eight different cases. The first five cases define the opcodes, the built in functions. Let’s look at them one by one.</p>
<ul>
<li>0 creates a law. (0 n a b) casts n and a to nats, forces recursive evaluation of b, and creates a law with name n, arity a and body b. See also the <a href="#w-write-law">W  operation</a>.</li>
<li>1 reflects by pattern matching. (1 p l a n x) evaluates an arbitrary PLAN value x, inspects the result, and depending on its shape, chooses one of the branches p, l, a or n. See also the <a href="#p-pattern-match">P operation</a>.</li>
<li>2 is structural recursion on nats. (2 z p x) casts an arbitrary PLAN value x to a nat, and branches on whether the result is 0 or not. See also the <a href="#c-recursion-on-naturals">C operation</a>.</li>
<li>3 is increment. (3 x) casts x to a nat and increments the result by 1.</li>
<li>4 pins a value. (4 x) forces normalization of x and puts it inside a pin. All realistic interpreters will also hash x and, if a value with the same hash already exists, deduplicate it.</li>
</ul>
<p>The three final cases define what it means to execute functions that aren’t built-in.</p>
<ul>
<li>If the function is an app (f x), the argument x is already included in the environment (remember that apps are closures; they define the environment), so we ignore it and simply recurse deeper to execute the actual function.</li>
<li>If the function is a pin, executing it is the same as executing the function inside the pin.</li>
<li>If the function is a law, we need to interpret the law body. This starts by building the environment, which is done using the B operation. Note that the law’s name isn’t used at all, it is only there to increase readability.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="b-build-law-environment"><code>B</code> (Build law environment)<a href="#b-build-law-environment" class="hash-link" aria-label="Direct link to b-build-law-environment" title="Direct link to b-build-law-environment">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">B[a,n,e,b,(1 _ k)] = B[a,n+1,(e &lt;&gt;),b,k]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">B[a,n,e,b,x]       = L[a,n,e,b]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This operation builds the environment for executing a law body by processing any let bindings. It takes four arguments:</p>
<ul>
<li>a: The initial arity/position for binding values</li>
<li>n: The current size of the environment</li>
<li>e: The current environment</li>
<li>b: The law body to evaluate</li>
<li>An optional fifth argument for let binding cases</li>
</ul>
<p>It works recursively:</p>
<ul>
<li>When encountering a let binding (1 _ k), it:<!-- -->
<ul>
<li>Extends the environment with a black hole placeholder (<code>&lt;&gt;</code>)</li>
<li>Increments the environment size</li>
<li>Recursively processes the rest of the bindings in k</li>
</ul>
</li>
<li>For non-let-binding values, passes control to L to evaluate the final body</li>
</ul>
<p>The black holes serve as mutable placeholders that will be filled in during evaluation by the L operation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="r-run-a-law"><code>R</code> (Run a law)<a href="#r-run-a-law" class="hash-link" aria-label="Direct link to r-run-a-law" title="Direct link to r-run-a-law">​</a></h3>
<p>This EDSL for law bodies is implemented by the R operation:</p>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">R(n,e,b:@) | b≤n = I(b,e,(n-b))         # if b=0 Self, otherwise Var b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R(n,e,(0 f x))   = (R(n,e,f) R(n,e,x))  # Apply f x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R(n,e,(1 v b))   = L(n,e,v,b)           # let v in b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R(n,e,(2 x))     = x                    # Literal x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">R(n,e,x)         = x                    # Literal x (fallback, incl b&gt;n)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s important to note that none of these patterns reduce under the normal PLAN evaluation rules defined by the X operation. The arities of the opcodes 0, 1 and 2 in the apps aren’t saturated, so the apps are kept as inert values. This allows any valid expression in the EDSL to be stored using this encoding.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="e-evaluate"><code>E</code> (Evaluate)<a href="#e-evaluate" class="hash-link" aria-label="Direct link to e-evaluate" title="Direct link to e-evaluate">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">E(o:@)     = o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E(o:&lt;x&gt;)   = o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E(o:(f x)) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   E(f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   when A(f)=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       o &lt;- X(o,o)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       E(o)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E(o:{n a b}) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if a!=0 then o else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       o &lt;- &lt;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       o &lt;- R(0,o,b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       E(o)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This evaluates an arbitrary PLAN expression to weak-head normal form and <em>replaces</em> it with the result in memory. This is important! E is a stateful operation. If the evaluated PLAN expression occurs in several locations on the heap due to structural sharing, all of them will change. This is how PLAN implements thunks.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="f-force-normalize"><code>F</code> (Force normalize)<a href="#f-force-normalize" class="hash-link" aria-label="Direct link to f-force-normalize" title="Direct link to f-force-normalize">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">F(o) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E(o)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    when o:(f x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         F(f); F(x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation that X uses to implement opcode 4. It recursively forces evaluation of an arbitrary PLAN expression, putting it into normal form.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="p-pattern-match"><code>P</code> (Pattern match)<a href="#p-pattern-match" class="hash-link" aria-label="Direct link to p-pattern-match" title="Direct link to p-pattern-match">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">P(p,l,a,n,(f x))   = (a f x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">P(p,l,a,n,&lt;x&gt;)     = (p x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">P(p,l,a,n,{n a b}) = (l n a b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">P(p,l,a,n,x:@}     = (n x)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation that X uses to implement opcode 1. It branches based on the structure of the PLAN value that is being inspected, passing the components to the appropriate continuation. This is what makes PLAN a fully reflective system.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="n-cast-to-nat"><code>N</code> (cast to Nat)<a href="#n-cast-to-nat" class="hash-link" aria-label="Direct link to n-cast-to-nat" title="Direct link to n-cast-to-nat">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">N(o) = E(o); if o:@ then o else 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation that X uses to implement opcodes 0 and 3. It evaluates a PLAN expression and casts the result to a nat by simply returning 0 for non-nat values.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="i-index"><code>I</code> (index<a href="#i-index" class="hash-link" aria-label="Direct link to i-index" title="Direct link to i-index">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">I(f, (e x), 0) = x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I(f, e,     0) = e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I(f, (e x), n) = I(f, e, n-1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I(f, e,     n) = f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation used by A and R. It takes a fallback case, an environment to index into – typically a nested app tree – and an index. It’s defined by recursion on the environment: if the index is 0, we’ve reached the bottom and should return either the tail or, if that’s not possible, the whole environment. If the index is greater than 0, we recur and decrement the index. If we can’t recur, we’re out of bounds and return the fallback case.</p>
<p>It’s worth noting that indices work from right to left instead of from left to right. This is because apps associate to the left. We could go in the other direction, but this would complicate the specification significantly without making any fundamental difference. Additionally, realistic implementations will have optimized nested app trees to arrays either way, so this change wouldn’t make implementation easier.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-arity"><code>A</code> (Arity)<a href="#a-arity" class="hash-link" aria-label="Direct link to a-arity" title="Direct link to a-arity">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A((f x))     = A(f)-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A(&lt;p&gt;)       = A(p)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A({n a b})   = a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A(n:@)       = I(1, (3 5 3), n)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation used by E. It simply returns the arity of a PLAN expression if interpreted as a function. The first three cases should be obvious. The arities of nats are hardcoded according to this table, which is implemented by the call to I, where 1 is a default value.</p>
<table><thead><tr><th>nat</th><th>arity</th><th>comment</th></tr></thead><tbody><tr><td>0</td><td>3</td><td>opcode “create a law”</td></tr><tr><td>1</td><td>5</td><td>opcode “reflect”</td></tr><tr><td>2</td><td>3</td><td>opcode “is zero?”</td></tr><tr><td>3</td><td>1</td><td>opcode “increment”</td></tr><tr><td>4</td><td>1</td><td>opcode “make pin”</td></tr><tr><td>n</td><td>1</td><td>crash with message m</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="l-let-binding"><code>L</code> (Let-binding)<a href="#l-let-binding" class="hash-link" aria-label="Direct link to l-let-binding" title="Direct link to l-let-binding">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">L(n,e,v,b) =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x := &lt;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    f := (e x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x &lt;- R(n+1,f,v)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    R(n+1,f,b)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation that is mutually recursive with R. It takes:</p>
<ul>
<li>i: The current binding position index (for multiple let bindings)</li>
<li>n: The environment size</li>
<li>e: The environment to extend with new value v</li>
<li>v: The value being bound (in let cases)</li>
<li>b: law body which should run against the environment after it has been extended with v</li>
</ul>
<p>For non-let cases, it simply runs the body in the current environment using R.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="c-recursion-on-naturals"><code>C</code> (reCursion on naturals)<a href="#c-recursion-on-naturals" class="hash-link" aria-label="Direct link to c-recursion-on-naturals" title="Direct link to c-recursion-on-naturals">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C[z,p,n] = if n=0 then z else p (n-1)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation that X uses to implement opcode 2. It implements primitive recursion on natural numbers, taking three arguments:</p>
<ul>
<li>A base case z to return when n=0</li>
<li>A successor case function p to apply to (n-1) when n&gt;0</li>
<li>A natural number n to recurse on</li>
</ul>
<p>This allows PLAN to implement structural recursion without needing explicit recursion primitives in the core language. When opcode 2 is executed via X[2, (_ z p x)], it evaluates x to a natural number and then uses C to either return the base case z (if x=0) or apply p to x-1 (if x&gt;0).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="s-saturate"><code>S</code> (Saturate)<a href="#s-saturate" class="hash-link" aria-label="Direct link to s-saturate" title="Direct link to s-saturate">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">S[o:(f x y)]       = (S[(f x)] y)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S[o:(&lt;{n a b}&gt; y)] = o</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S[o:(&lt;f&gt; x)]       = S[(f x)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">S[o]               = o</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation that E uses during evaluation. It handles saturation of function applications - determining when a function has received enough arguments to evaluate. The rules handle several cases:</p>
<ul>
<li>For nested applications (f x y), recurse left-associatively by first saturating (f x) and then applying y</li>
<li>For a pinned law being applied <code>(&lt;{n a b}&gt; y)</code>, preserve the entire expression</li>
<li>For a pinned function being applied <code>(&lt;f&gt; x)</code>, recurse into the application</li>
<li>For any other value, return it unchanged</li>
</ul>
<p>S is called during evaluation when a function of arity 1 is encountered, ensuring proper handling of nested applications and pinned values before execution continues.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="w-write-law"><code>W</code> (Write law)<a href="#w-write-law" class="hash-link" aria-label="Direct link to w-write-law" title="Direct link to w-write-law">​</a></h3>
<div class="language-unset codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-unset codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">W[n,a,b] | n&gt;0 = {n,a,b}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This is a helper operation that X uses to implement opcode 0 (law creation). It constructs a law value only if the law&#x27;s name is a positive natural number, enforcing a basic validation rule on law definitions. The operation takes three arguments:</p>
<ul>
<li>A natural number n for the law&#x27;s name, which must be &gt;0</li>
<li>A natural number a specifying the law&#x27;s arity</li>
<li>A value b containing the law&#x27;s body</li>
</ul>
<p>When opcode 0 is executed via X[0, (_ n a b)], it first normalizes its arguments using N[n], N[a], and F[b] respectively, then attempts to construct a law using W. If the normalized name is 0 or negative, the operation will diverge according to the &quot;Unmatched patterns diverge&quot; rule, preventing the creation of invalid laws.
The validation that n&gt;0 ensures all laws in the system have proper positive natural number identifiers, which may be important for the reflection capabilities provided by opcode 1.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/operating-function/pallas/edit/main/doc/../../doc/reference/plan/plan.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/reference/vm-and-interpreter/effects-reference"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Effects Reference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#law-body-edsl" class="table-of-contents__link toc-highlight">Law body EDSL</a></li><li><a href="#evaluation-in-detail" class="table-of-contents__link toc-highlight">Evaluation in detail</a><ul><li><a href="#black-holes-" class="table-of-contents__link toc-highlight">Black Holes (<code>&lt;&gt;</code>)</a></li><li><a href="#x-function-execution" class="table-of-contents__link toc-highlight"><code>X</code> (function eXecution)</a></li><li><a href="#b-build-law-environment" class="table-of-contents__link toc-highlight"><code>B</code> (Build law environment)</a></li><li><a href="#r-run-a-law" class="table-of-contents__link toc-highlight"><code>R</code> (Run a law)</a></li><li><a href="#e-evaluate" class="table-of-contents__link toc-highlight"><code>E</code> (Evaluate)</a></li><li><a href="#f-force-normalize" class="table-of-contents__link toc-highlight"><code>F</code> (Force normalize)</a></li><li><a href="#p-pattern-match" class="table-of-contents__link toc-highlight"><code>P</code> (Pattern match)</a></li><li><a href="#n-cast-to-nat" class="table-of-contents__link toc-highlight"><code>N</code> (cast to Nat)</a></li><li><a href="#i-index" class="table-of-contents__link toc-highlight"><code>I</code> (index</a></li><li><a href="#a-arity" class="table-of-contents__link toc-highlight"><code>A</code> (Arity)</a></li><li><a href="#l-let-binding" class="table-of-contents__link toc-highlight"><code>L</code> (Let-binding)</a></li><li><a href="#c-recursion-on-naturals" class="table-of-contents__link toc-highlight"><code>C</code> (reCursion on naturals)</a></li><li><a href="#s-saturate" class="table-of-contents__link toc-highlight"><code>S</code> (Saturate)</a></li><li><a href="#w-write-law" class="table-of-contents__link toc-highlight"><code>W</code> (Write law)</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/explanation/system-overview">System Overview</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/vaporwareNetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/__vaporware__" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opfn.co" target="_blank" rel="noopener noreferrer" class="footer__link-item">opfn</a></li><li class="footer__item"><a href="https://blog.vaporware.network" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/operating-function/pallas" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>